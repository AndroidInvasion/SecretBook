language: default

cache:
    directories:
     - /home/travis/.gradle/

services:
- docker

before_script:
- openssl aes-256-cbc -K $encrypted_8d441ecbf331_key -iv $encrypted_8d441ecbf331_iv -in ./deploy/secret.tar.enc -out ./deploy/secret.tar -d
- cd ./deploy && tar xvf secret.tar && cd ../

script:
- docker build -t secretbookimage .
- ls ~/.gradle
- docker run --env TRAVIS_BUILD_NUMBER=$TRAVIS_BUILD_NUMBER --env TRAVIS_COMMIT_MESSAGE="$TRAVIS_COMMIT_MESSAGE" -v $TRAVIS_BUILD_DIR/dockerOut:/dockerOut:rw -v ~/.gradle:/opt/gradle:rw secretbookimage
- ls $TRAVIS_BUILD_DIR/dockerOut
- ls ~/.gradle

branches:
  only:
    - dev
    - deploy
